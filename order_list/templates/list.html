{% extends "base.html" %}
{% load static %}
{% load extras %}
{% load humanize %}
{% block stylesheets %}
    <style>
        #bootstrap-table {
            overflow-x: scroll;
            overflow-y: scroll;
            display: block;
            white-space: nowrap;
            table-layout:fixed;

        {#width: auto;#}
        }
        tbody {
            overflow-y: auto;
        }
        th, td{ text-align: center; }

        th {
            font-weight: bold;
        }
        td{
            overflow:hidden;
            text-overflow: ellipsis;
        }
        table.dataTable tbody tr.selected {
            color: white;
            background-color: cornflowerblue;
        }

        body {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        select {
            min-width: 150px;
            width: auto;
            height: 10px;
        }
        .badge{
            font-size: 1rem;
            margin: 0;
        }
        .dropdown-menu > li > a:hover, .dropdown-menu > li > a:focus {
            background-image:none !important;
        }
        .dropdown-menu > li > a:hover, .dropdown-menu > li > a:focus {
            background-color:pink;
        }
        .card {
            margin: 0 auto; /* Added */
            float: none; /* Added */
            margin-bottom: 10px; /* Added */
        }
    </style>
{% endblock stylesheets %}

{% block body %}

    <!-- *** 사이드 내비게이션 바 -->
    {% include 'navigation.html' %}

    <div class="main">

        <!-- *** 상위 내비게이션 바 *** -->
        {% include 'top-navigation.html' %}

        <main class="content">
            <div class="container-fluid">

                <div class="header" style="overflow: hidden; margin-bottom: 23px;">
                    <a class="sidebar-toggle d-flex mr-2" style="float: left; height: 32px; line-height: 32px;">
                        <i class="hamburger align-self-center"></i>
                    </a>
                    <h1 class="header-title" style="font-family: 'NanumSquareEB'; float: left;">
                        주문 목록
                    </h1>
                </div>

                <!-- *** 검색 바 *** -->
                {% include 'search_bar.html' %}

                <!-- *** 버튼 바 *** -->
                <div class="row">
                    <div class="col-12">
                        <div class="card" style="height: 50px; min-width: 1200px;">
                            <div class="card-body">
                                <div class="row">
                                    <div class="btn-group btn-group mb-4 align-items-center" role="group" style="padding: 0 2px;">
                                        <button type="button" class="btn btn-primary" onclick="location.href='/sheet/order_sheet';">주문서 작성</button>
                                    </div>
                                    <div class="btn-group btn-group mb-4 align-items-center" role="group" style="padding: 0 2px;">
                                        <button type="button" class="btn btn-success" onclick="uploadpopup();">Excel 업로드</button>
                                    </div>
                                    <div class="btn-group btn-group mb-4 align-items-center" role="group" style="padding: 0 2px;">
                                        <button type="button" class="btn btn-success" onclick="filecreate();">Excel 다운로드</button>
                                    </div>
                                    <div class="btn-group btn-group mb-4 align-items-center" role="group" style="padding: 0 2px;">
                                        <button class="btn btn-success" type="button" onclick="orderUpdate();">주문 수정</button>
                                    </div>
                                    <div class="btn-group btn-group mb-4 align-items-center" role="group" style="padding: 0 2px;">
                                        <button class="btn btn-success" type="button" onclick="orderDelete();">주문 삭제</button>
                                    </div>
                                    <div class="btn-group drop-end mb-4 align-items-center mr-auto" role="group" style="padding: 0 2px;">
                                        <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"
                                                aria-expanded="false">
                                            상태변경
                                        </button>
                                        <div class="dropdown-menu">
                                            <a type="button" class="dropdown-item" onclick="changeStatus(0);">주문완료</a>
                                            <a type="button" class="dropdown-item" onclick="changeStatus(3);">출고보류</a>
                                            <a type="button" class="dropdown-item" onclick="changeStatus(4);">출고취소</a>
                                            <a type="button" class="dropdown-item" onclick="changeStatus(5);">기타</a>
                                        </div>
                                    </div>
                                    {% if valuedate == 'deploy' %}
                                    <div class="btn-group btn-group mb-4 align-items-center" role="group" style="padding: 0 2px;">
                                        <button type="button" class="btn btn-success" onclick="printAll();">개별 주문장 출력</button>
                                    </div>
                                    <div class="btn-group btn-group mb-4 align-items-center" role="group" style="padding: 0 2px;">
                                        <button type="button" class="btn btn-success" onclick="excelcreate();">송장 다운로드</button>
                                    </div>
                                    {% endif %}
                                    <div class="btn-group btn-group mb-4 align-items-center" role="group" style="padding: 0 2px;">
                                        <button class="btn btn-success" onclick="changeStatus(1);">제작완료</button>
                                    </div>
                                    <div class="btn-group btn-group mb-4 align-items-center" role="group" style="padding: 0 2px;">
                                        <button class="btn btn-success" onclick="changeStatus(2);">출고완료</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="col-12 d-flex" style="min-width: 1200px;">
                        <div class="card flex-fill">
                            <!-- *** Bootstrap 테이블 *** -->
                            <div class="col-12" style="padding: 0">
                                <div class="card w-100" style="">
                                {% if valuedate == 'order' %}
                                    <table class="table table-bordered table-intel table-md cell-border"
                                           id="bootstrap-table"
                                           style="table-layout: fixed; width: 100%; height: auto; min-height: 700px;">
                                        <thead>
                                        <tr style="font-family: 'NanumSquareL';"
                                            onmousedown="return false" onselect="return true" onmouseup="return true">
                                            <th class="filters" data-sortable="true" id="th-pno" hidden="hidden">pno</th>
                                            <th class="filters" data-sortable="true" id="th-order_date" style="">주문일자</th>
                                            <th class="filters" data-sortable="true" id="th-order_no" style="">주문 No.</th>
                                            <th id="th-state" class="filters" data-sortable="true" style="">진행상태</th>
                                            <th class="filters" data-sortable="true" id="th-customer">주문고객</th>
                                            <th class="filters" data-sortable="true" id="th-customer_phone">고객연락처</th>
                                            <th class="filters" data-sortable="true" id="th-product_name">품목</th>
                                            <th class="filters" data-sortable="true" id="th-count">수량</th>
                                            <th class="filters" data-sortable="true" id="th-size_option_name">사이즈</th>
                                            <th class="filters" data-sortable="true" id="th-sheet_option_name">시트</th>
                                            <th class="filters" data-sortable="true" id="th-filling_option_name">필링</th>
                                            <th class="filters" data-sortable="true" id="th-phrase_option_name">문구</th>
                                            <th class="filters" data-sortable="true" id="th-memo">주문메모</th>
                                            <th class="filters" data-sortable="true" id="th-boxing_option_name">포장</th>
                                            <th class="filters" data-sortable="true" id="th-product_price">금액</th>
                                            <th class="filters" data-sortable="true" id="th-delivery_option_name">수령방법</th>
                                            <th class="filters" data-sortable="true" id="th-recipient">수령인</th>
                                            <th class="filters" data-sortable="true" id="th-recipient_phone">수령인연락처</th>
                                            <th class="filters" data-sortable="true" id="th-address1">수령주소</th>
                                            <th class="filters" data-sortable="true" id="th-address2">상세주소</th>
                                            <th class="filters" data-sortable="true" id="th-recipient_date">납품일자</th>
                                            <th class="filters" data-sortable="true" id="th-recipient_hour">납품시간</th>
                                            <th class="filters" data-sortable="true" id="th-order_type_name">주문경로</th>
                                            <th class="filters" data-sortable="true" id="th-pay_type_name">결제방법</th>
                                            <th class="filters" data-sortable="true" id="th-pay_check">결제여부</th>
                                            <th class="filters" data-sortable="true" id="th-pay_check">카페24번호</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for order in orderDetail %}
                                            <!-- *** 주문 목록 테이블 상세 *** -->
                                            <tr style="display: table-row; border-color: darkgrey" id="order{{ order.order_no }}">
                                                <td hidden="hidden"><input hidden="hidden" class="pageobj_pno" name="pno" id="pno{{ order.pno }}" type="text" value="{{ order.pno }}"></td>
                                                <td id="data-order-date" class="dateline">{{ order.order_date|date:'y-m-d' }}</td>
                                                <td id="modal{{ order.pno }}" class="order_no" data-toggle="modal" data-target="#sizedModalLg{{ order.pno }}">
                                                    {{ order.date_no|zeroadd:3 }}
                                                </td>
                                                {% if order.state == '주문완료' %}
                                                    <td style="padding: 0"><span id="order_state" class="badge badge-warning">{{ order.state }}</span></td>
                                                {% elif order.state == '제작완료' %}
                                                    <td style="padding: 0"><span id="order_state" class="badge badge-success">{{ order.state }}</span></td>
                                                {% elif order.state == '출고완료' %}
                                                    <td style="padding: 0"><span id="order_state" class="badge badge-primary">{{ order.state }}</span></td>
                                                {% elif order.state == '출고보류' %}
                                                    <td style="padding: 0"><span id="order_state" class="badge badge-secondary">{{ order.state }}</span></td>
                                                {% elif order.state == '출고취소' %}
                                                    <td style="padding: 0"><span id="order_state" class="badge badge-danger">{{ order.state }}</span></td>
                                                {% elif order.state == '기타' %}
                                                    <td style="padding: 0"><span id="order_state" class="badge badge-info">{{ order.state }}</span></td>
                                                {% endif %}
                                                <td class="customerline">{{ order.customer }}</td>
                                                <td class="phoneline">{{ order.customer_phone|phone }}</td>
                                                <td>{{ order.product_name }}</td>
                                                <td>{{ order.count }}</td>
                                                <td>{{ order.size_option_name }}</td>
                                                <td>{{ order.sheet_option_name }}</td>
                                                <td>{{ order.filling_option_name }}</td>
                                                <td>{{ order.phrase }}</td>
                                                <td>{{ order.memo }}</td>
                                                <td>{{ order.boxing_option_name }}</td>
                                                <td>{{ order.product_price|intcomma }}</td>
                                                <td>{{ order.delivery_option_name }}</td>
                                                <td>{{ order.recipient }}</td>
                                                <td>{{ order.recipient_phone|phone }}</td>
                                                <td>{{ order.address1 }}</td>
                                                <td>{{ order.address2 }}</td>
                                                <td class="deployline">{{ order.receipt_date|date:'y-m-d' }}</td>
                                                <td>{{ order.receipt_hour|time }}</td>
                                                <td>{{ order.order_type_name }}</td>
                                                <td>{{ order.pay_type_name }}</td>
                                                <td>{{ order.pay_check }}</td>
                                                <td>{{ order.cafe24_no|cafe }}</td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                {% elif valuedate == 'deploy' %}
                                    <table class="table table-bordered table-intel table-md cell-border"
                                           id="bootstrap-table"
                                           style="table-layout: fixed; width: 100%; height: auto; min-height: 700px;">
                                        <thead>
                                        <tr style="font-family: 'NanumSquareL';"
                                            onmousedown="return false" onselect="return true" onmouseup="return true">
                                            <th class="filters" data-sortable="true" id="th-pno" hidden="hidden">pno</th>
                                            <th class="filters" data-sortable="true" id="th-recipient_date">납품일자</th>
                                            <th class="filters" data-sortable="true" id="th-order_no" style="">주문 No.</th>
                                            <th id="th-state" class="filters" data-sortable="true" style="">진행상태</th>
                                            <th class="filters" data-sortable="true" id="th-recipient_hour">납품시간</th>
                                            <th class="filters" data-sortable="true" id="th-customer">고객명</th>
                                            <th class="filters" data-sortable="true" id="th-customer_phone">고객연락처</th>
                                            <th class="filters" data-sortable="true" id="th-product_name">품목</th>
                                            <th class="filters" data-sortable="true" id="th-count">수량</th>
                                            <th class="filters" data-sortable="true" id="th-size_option_name">사이즈</th>
                                            <th class="filters" data-sortable="true" id="th-sheet_option_name">시트</th>
                                            <th class="filters" data-sortable="true" id="th-filling_option_name">필링</th>
                                            <th class="filters" data-sortable="true" id="th-phrase_option_name">문구</th>
                                            <th class="filters" data-sortable="true" id="th-memo">주문메모</th>
                                            <th class="filters" data-sortable="true" id="th-boxing_option_name">포장</th>
                                            <th class="filters" data-sortable="true" id="th-product_price">금액</th>
                                            <th class="filters" data-sortable="true" id="th-delivery_option_name">수령방법</th>
                                            <th class="filters" data-sortable="true" id="th-recipient">수령인</th>
                                            <th class="filters" data-sortable="true" id="th-recipient_phone">수령인연락처</th>
                                            <th class="filters" data-sortable="true" id="th-address1">수령주소</th>
                                            <th class="filters" data-sortable="true" id="th-address2">상세주소</th>
                                            <th class="filters" data-sortable="true" id="th-order_date" style="">주문일자</th>
                                            <th class="filters" data-sortable="true" id="th-order_type_name">주문경로</th>
                                            <th class="filters" data-sortable="true" id="th-pay_type_name">결제방법</th>
                                            <th class="filters" data-sortable="true" id="th-pay_check">결제여부</th>
                                            <th class="filters" data-sortable="true" id="th-pay_check">카페24번호</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for order in orderDetail %}
                                            <!-- *** 주문 목록 테이블 상세 *** -->
                                            <tr style="display: table-row; border-color: darkgrey" id="order{{ order.order_no }}">
                                                <td hidden="hidden"><input hidden="hidden" class="pageobj_pno" name="pno" id="pno{{ order.pno }}" type="text" value="{{ order.pno }}"></td>
                                                <td class="deployline">{{ order.receipt_date|date:'y-m-d' }}</td>
                                                <td id="modal{{ order.pno }}" class="order_no" data-toggle="modal" data-target="#sizedModalLg{{ order.pno }}">
                                                    {{ order.date_no|zeroadd:3 }}
                                                </td>
                                                {% if order.state == '주문완료' %}
                                                    <td style="padding: 0"><span id="order_state" class="badge badge-warning">{{ order.state }}</span></td>
                                                {% elif order.state == '제작완료' %}
                                                    <td style="padding: 0"><span id="order_state" class="badge badge-success">{{ order.state }}</span></td>
                                                {% elif order.state == '출고완료' %}
                                                    <td style="padding: 0"><span id="order_state" class="badge badge-primary">{{ order.state }}</span></td>
                                                {% elif order.state == '출고보류' %}
                                                    <td style="padding: 0"><span id="order_state" class="badge badge-secondary">{{ order.state }}</span></td>
                                                {% elif order.state == '출고취소' %}
                                                    <td style="padding: 0"><span id="order_state" class="badge badge-danger">{{ order.state }}</span></td>
                                                {% elif order.state == '기타' %}
                                                    <td style="padding: 0"><span id="order_state" class="badge badge-info">{{ order.state }}</span></td>
                                                {% endif %}
                                                <td>{{ order.receipt_hour|time }}</td>
                                                <td class="customerline">{{ order.customer }}</td>
                                                <td class="phoneline">{{ order.customer_phone|phone }}</td>
                                                <td>{{ order.product_name }}</td>
                                                <td>{{ order.count }}</td>
                                                <td>{{ order.size_option_name }}</td>
                                                <td>{{ order.sheet_option_name }}</td>
                                                <td>{{ order.filling_option_name }}</td>
                                                <td>{{ order.phrase }}</td>
                                                <td>{{ order.memo }}</td>
                                                <td>{{ order.boxing_option_name }}</td>
                                                <td>{{ order.product_price|intcomma }}</td>
                                                <td>{{ order.delivery_option_name }}</td>
                                                <td>{{ order.recipient }}</td>
                                                <td>{{ order.recipient_phone|phone }}</td>
                                                <td>{{ order.address1 }}</td>
                                                <td>{{ order.address2 }}</td>
                                                <td id="data-order-date" class="dateline">{{ order.order_date|date:'y-m-d' }}</td>
                                                <td>{{ order.order_type_name }}</td>
                                                <td>{{ order.pay_type_name }}</td>
                                                <td>{{ order.pay_check }}</td>
                                                <td>{{ order.cafe24_no|cafe }}</td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                {% endif %}
                                    <!-- 페이징처리 시작 -->
                                    <ul class="pagination justify-content-center" style="margin-top: 10px;">
                                        <!-- 처음페이지 -->
                                        {% if orderDetail.has_previous %}
                                            <li class="page-item">
                                                <a class="page-link" data-page="1" href="#"><<</a>
                                            </li>
                                        {% endif %}
                                        <!-- 이전페이지 -->
                                        {% if orderDetail.has_previous %}
                                            <li class="page-item">
                                                <a class="page-link" data-page="{{ orderDetail.previous_page_number }}" href="#">이전</a>
                                            </li>
                                        {% else %}
                                            <li class="page-item disabled">
                                                <a class="page-link" tabindex="-1" aria-disabled="true" href="#">이전</a>
                                            </li>
                                        {% endif %}
                                        <!-- 페이지리스트 -->
                                        {% for page_number in orderDetail.paginator.page_range %}
                                            {% if page_number >= orderDetail.number|add:-10 and page_number <= orderDetail.number|add:10 %}
                                                {% if page_number == orderDetail.number %}
                                                    <li class="page-item active" aria-current="page">
                                                        <a class="page-link" data-page="{{ page_number }}" href="#">{{ page_number }}</a>
                                                    </li>
                                                {% else %}
                                                    <li class="page-item">
                                                        <a class="page-link" data-page="{{ page_number }}" href="#">{{ page_number }}</a>
                                                    </li>
                                                {% endif %}
                                            {% endif %}
                                        {% endfor %}
                                        <!-- 다음페이지 -->
                                        {% if orderDetail.has_next %}
                                            <li class="page-item">
                                                <a class="page-link" data-page="{{ orderDetail.next_page_number }}" href="#">다음</a>
                                            </li>
                                        {% else %}
                                            <li class="page-item disabled">
                                                <a class="page-link" tabindex="-1" aria-disabled="true" href="#">다음</a>
                                            </li>
                                        {% endif %}
                                        <!-- 마지막페이지 -->
                                        {% if orderDetail.has_next %}
                                            <li class="page-item">
                                                <a class="page-link" data-page="{{ max_index }}" href="#">>></a>
                                            </li>
                                        {% endif %}
                                    </ul>
                                    <!-- end pagination -->
                                    <!-- 검색조건 form -->
                                    <form id="searchForm" method="GET" action="{% url 'list:home' %}">
                                        <input type="hidden" id="valuedate" name="valuedate" value="{{ valuedate|default_if_none:'order' }}">
                                        <input type="hidden" id="startdate" name="startdate" value="{{ startdate|default_if_none:'' }}"/>
                                        <input type="hidden" id="enddate" name="enddate" value="{{ enddate|default_if_none:'' }}"/>
                                        <input type="hidden" id="kwtype" name="kwtype" value="{{ kwtype|default_if_none:'' }}">
                                        <input type="hidden" id="kw" name="kw" value="{{ kw|default_if_none:'' }}">
                                        <input type="hidden" id="page" name="page" value="{{ page }}">
                                        <input type="hidden" id="page_count" name="count" value="{{ count }}">
                                    </form>
                                    <!-- end form -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </main>

        <!-- *** 주문 상세 모달 *** -->
{#            <div class="modal fade" id="sizedModalLg{{ order.pno }}" tabindex="-1" role="dialog" aria-hidden="true">#}
{#                <div class="modal-dialog modal-lg" role="document">#}
{#                    <div class="modal-content">#}
{#                        <div class="modal-header">#}
{#                            <h2 style="font-family: 'NanumSquareEB;" class="modal-title">{{ order.customer }}님의 주문 내역</h2>#}
{#                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">#}
{#                                <span aria-hidden="true">&times;</span>#}
{#                            </button>#}
{#                        </div>#}
{#                        <div class="modal-body m-3">#}
{#                            <div class="row">#}
{#                                <div class="col-md-12">#}
{#                                    <div class="card">#}
{#                                        <div class="card-body">#}
{#                                            <form action="" method="get">#}
{#                                                <input type="hidden" id="pno{{ order.pno }}" name="pno" value="{{ order.pno }}">#}
{#                                                <div class="form-row">#}
{#                                                    <div class="form-group col-md-2">#}
{#                                                        <label for="">주문 접수자</label>#}
{#                                                        <i class="align-middle mr-2 fas fa-fw fa-user-friends"></i>#}
{#                                                        <input type="text" class="form-control" name="employee_name" value="{{ order.employee_name }}">#}
{#                                                    </div>#}
{#                                                    <div class="form-group col-md-4">#}
{#                                                        <label for="">주문일자</label>#}
{#                                                        <i class="align-middle mr-2 far fa-fw fa-calendar-alt"></i>#}
{#                                                        <input type="text" class="form-control" id="" value="{{ order.order_date }}">#}
{#                                                    </div>#}
{#                                                    <div class="form-group col-md-3">#}
{#                                                        <label for="order-root">주문 경로</label>#}
{#                                                        <select class="form-control select1" data-toggle="select1">#}
{#                                                            {% for order_type in order_type_table %}#}
{#                                                                {% if order_type.order_type_name == order.order_type_name %}#}
{#                                                                    <option value="{{ order_type.order_type_name }}" selected>{{ order.order_type_name }}</option>#}
{#                                                                {% else %}#}
{#                                                                    <option value="{{ order_type.order_type_name }}">{{ order_type.order_type_name }}</option>#}
{#                                                                {% endif %}#}
{#                                                            {% endfor %}#}
{#                                                        </select>#}
{#                                                    </div>#}
{#                                                    <div class="form-group col-md-2">#}
{#                                                        <label for="order-root">수령방법</label>#}
{#                                                        <select class="form-control select1" data-toggle="select1">#}
{#                                                            {% for delivery in delivery_table %}#}
{#                                                                {% if delivery.delivery_name == order.delivery_option_name %}#}
{#                                                                    <option value="{{ delivery.delivery_name }}" selected>{{ order.delivery_option_name }}</option>#}
{#                                                                {% else %}#}
{#                                                                    <option value="{{ delivery.delivery_name}}">{{ delivery.delivery_name }}</option>#}
{#                                                                {% endif %}#}
{#                                                            {% endfor %}#}
{#                                                        </select>#}
{#                                                    </div>#}
{#                                                </div>#}
{##}
{#                                                <!-- 고객명 / 연락처 / 납품일자 / 도착시간 -->#}
{#                                                <div class="form-row">#}
{#                                                    <div class="form-group col-md-2">#}
{#                                                        <label for="inputCity">고객명</label>#}
{#                                                        <input type="text" class="form-control" name="" value="{{ order.customer }}">#}
{#                                                    </div>#}
{#                                                    <div class="form-group col-md-4">#}
{#                                                        <label for="inputCity">연락처</label>#}
{#                                                        <input type="text" class="form-control" value="{{ order.customer_phone|phone }}">#}
{#                                                    </div>#}
{##}
{#                                                    <div class="form-group col-md-3">#}
{#                                                        <label for="inputCity">납품일자</label>#}
{#                                                        <i class="align-middle mr-2 far fa-fw fa-calendar-alt"></i>#}
{#                                                        <input type="text" class="form-control" id="" value="{{ order.receipt_date }}">#}
{#                                                    </div>#}
{#                                                    <div class="form-group col-md-2">#}
{#                                                        <label for="inputCity">도착시간</label>#}
{#                                                        <i class="align-middle mr-2 far fa-fw fa-clock"></i>#}
{#                                                        <input type="text" class="form-control" id="inputCity" value="{{ order.receipt_hour }}">#}
{#                                                    </div>#}
{#                                                </div>#}
{##}
{#                                                <!-- 품목 / 옵션 -->#}
{#                                                <div class="form-row">#}
{#                                                    <div class="form-group col-md-3">#}
{#                                                        <span>품목명</span>#}
{#                                                    </div>#}
{#                                                </div>#}
{#                                                <div class="card" id="item-card">#}
{#                                                    <div class="card-body">#}
{#                                                        <!-- 1번째 품목 -->#}
{#                                                        <div class="form-group row">#}
{#                                                            <button class="item-button" style="margin-left: 5px; border-color: white;#}
{#                                                background-color: #153d77; color: white">1</button>#}
{#                                                            <div class="col-md-4">#}
{#                                                                <input type="text" class="form-control" value="{{ order.product_name }}">#}
{#                                                            </div>#}
{#                                                            <!-- 옵션 결과 불러올 때, 전체 결과 조합해서 보여주기 -->#}
{#                                                            <button type="button" class="btn item-button" style="border-color: white;#}
{#                                                background-color: #153d77; color: white"#}
{#                                                                    data-toggle="modal" data-target="sizedModalLg{{ order.pno }}">+ 옵션변경</button>#}
{#                                                            <div class="col-md-4">#}
{#                                                                <input type="text" class="form-control" value="{{ order.size_option_name }} / {{ order.filling_option_name }} / {{ order.sheet_option_name }} / {{ order.boxing_option_name }} / {{ order.phrase }}">#}
{#                                                            </div>#}
{#                                                            <div class="col-md-1" style="padding-left: 0">#}
{#                                                                <input type="number" class="form-control" value="{{ order.count }}">#}
{#                                                            </div>#}
{#                                                            <label style="padding-right: 20px;" class="col-form-label" for="">개</label>#}
{#                                                        </div>#}
{#                                                        <div class="form-group row justify-content-end">#}
{#                                                            <label style="padding-left: 20px;" class="col-form-label" for="">금액</label>#}
{#                                                            <div class="col-md-4">#}
{#                                                                <input type="text" class="form-control" value="{{ order.product_price }}">#}
{#                                                            </div>#}
{#                                                        </div>#}
{##}
{#                                                        <!-- 상품 추가 버튼 -->#}
{#                                                        <div class="form-group row">#}
{#                                                            <button class="btn btn-block" id="add-product" style="margin-left: 50px; margin-top: 30px;#}
{#                                                 background-color: #153d77; color: white; width: 30%;">+ 상품 추가</button>#}
{#                                                        </div>#}
{#                                                        <!-- 총 금액 표시 -->#}
{#                                                        <div class="form-group row" style="float: right; clear: both;">#}
{#                                                            <label style="padding-left: 20px;" class="col-form-label" for="">총</label>#}
{#                                                            <div class="col-md-10">#}
{#                                                                <input type="text" class="form-control" value="{{ order.total_price }}">#}
{#                                                            </div>#}
{#                                                        </div>#}
{##}
{#                                                    </div>#}
{#                                                </div>#}
{##}
{#                                                <!-- 결제금액 / 결제여부 / 결제방법 -->#}
{#                                                <div class="form-row">#}
{#                                                    <div class="form-group col-md-2">#}
{#                                                        <label for="inputCity">결제금액</label>#}
{#                                                        <input type="text" class="form-control" id="" value="{{ order.total_price }}">#}
{#                                                    </div>#}
{#                                                    <div class="col-md-6" style="margin-bottom: 16px;">#}
{#                                                        <label for="inputCity">결제여부</label>#}
{#                                                        <div class="col-md-6" style="align-items: center;" id="radio-result">#}
{#                                                            <label class="form-check form-check-inline" style="margin-top: 8px; margin-right: 30px;">#}
{#                                                                <input class="form-check-input" type="radio" name="radio_pay_check_yes" value="{{ order.pay_check }}">#}
{#                                                                <span class="form-check-label">완료</span>#}
{#                                                            </label>#}
{#                                                            <label class="form-check form-check-inline">#}
{#                                                                <input class="form-check-input" type="radio" name="radio_pay_check_no" value="{{ order.pay_check }}">#}
{#                                                                <span class="form-check-label">미완료</span>#}
{#                                                            </label>#}
{#                                                        </div>#}
{#                                                    </div>#}
{#                                                    <div class="form-group col-md-4" style="margin-left: -200px;">#}
{#                                                        <label for="order-root">결제 방법</label>#}
{#                                                        <select class="form-control select1" data-toggle="select1">#}
{#                                                            {% for pay in pay_table %}#}
{#                                                                {% if pay.pay_type_name == order.pay_type_name %}#}
{#                                                                    <option value="{{ pay.pay_type_name }}" selected>{{ order.pay_type_name }}</option>#}
{#                                                                {% else %}#}
{#                                                                    <option value="{{ pay.pay_type_name }}">{{ pay.pay_type_name }}</option>#}
{#                                                                {% endif %}#}
{#                                                            {% endfor %}#}
{#                                                        </select>#}
{#                                                    </div>#}
{#                                                </div>#}
{#                                                <!-- 동일인 체크 버튼 -->#}
{#                                                <div class="form-row" style="margin-top: 20px;">#}
{#                                                    <div class="form-inline">#}
{#                                                        <div class="custom-control custom-checkbox mb-1 mr-sm-2">#}
{#                                                            {% if order.customer == order.recipient %}#}
{#                                                            <input type="checkbox" checked class="custom-control-input" id="customControlInline">#}
{#                                                            {% else %}#}
{#                                                            <input type="checkbox" class="custom-control-input" id="customControlInline">#}
{#                                                            {% endif %}#}
{#                                                            <label class="custom-control-label" for="customControlInline"#}
{#                                                                   style="color: darkgray; font-size: 13px;">주문 고객과 동일</label>#}
{#                                                        </div>#}
{#                                                    </div>#}
{#                                                </div>#}
{##}
{#                                                <!-- 수령인명 / 수령인 연락처 -->#}
{#                                                <div class="form-row" style="margin-top: 10px;">#}
{#                                                    <div class="form-group col-md-3">#}
{#                                                        <label for="">수령인명</label>#}
{#                                                        <input type="text" class="form-control" id="" value="{{ order.recipient }}">#}
{#                                                    </div>#}
{#                                                    <div class="form-group col-md-3">#}
{#                                                        <label for="">수령인 연락처</label>#}
{#                                                        <input type="text" class="form-control" id="" value="{{ order.recipient_phone|phone }}">#}
{#                                                    </div>#}
{#                                                </div>#}
{##}
{#                                                <!-- 수령인 주소 / 우편번호 검색 -->#}
{#                                                <div class="">#}
{#                                                    <label style="padding-right: 10px;" class="col-form-label" for="">수령인 주소</label>#}
{#                                                </div>#}
{#                                                <div class="form-group row">#}
{#                                                    <div class="col-md-4">#}
{#                                                        <input type="text" class="form-control" id="" value="{{ order.address1 }}">#}
{#                                                    </div>#}
{#                                                    <div class="col-md-4">#}
{#                                                        <input type="text" class="form-control" id="" value="{{ order.address2 }}">#}
{#                                                    </div>#}
{#                                                </div>#}
{##}
{#                                                <!-- 주문메모 -->#}
{#                                                <div class="form-row">#}
{#                                                    <div class="form-group col-md-12">#}
{#                                                        <label class="form-label">주문메모</label>#}
{#                                                        <textarea style="width: 100%;" class="form-control" rows="5" cols="">{{ order.memo }}</textarea>#}
{#                                                    </div>#}
{#                                                </div>#}
{#                                            </form>#}
{#                                        </div>#}
{#                                    </div>#}
{#                                </div>#}
{#                            </div>#}
{#                            <!-- 상태 -->#}
{#                            <input name="state" type="text" hidden="hidden" value="{{ order.state }}">#}
{#                        </div>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
        <!-- END  modal -->

        {% include 'footer.html' %}

    </div>

    <svg width="0" height="0" style="position:absolute">
        <defs>
            <symbol viewBox="0 0 512 512" id="ion-ios-pulse-strong">
                <path
                        d="M448 273.001c-21.27 0-39.296 13.999-45.596 32.999h-38.857l-28.361-85.417a15.999 15.999 0 0 0-15.183-10.956c-.112 0-.224 0-.335.004a15.997 15.997 0 0 0-15.049 11.588l-44.484 155.262-52.353-314.108C206.535 54.893 200.333 48 192 48s-13.693 5.776-15.525 13.135L115.496 306H16v31.999h112c7.348 0 13.75-5.003 15.525-12.134l45.368-182.177 51.324 307.94c1.229 7.377 7.397 11.92 14.864 12.344.308.018.614.028.919.028 7.097 0 13.406-3.701 15.381-10.594l49.744-173.617 15.689 47.252A16.001 16.001 0 0 0 352 337.999h51.108C409.973 355.999 427.477 369 448 369c26.511 0 48-22.492 48-49 0-26.509-21.489-46.999-48-46.999z">
                </path>
            </symbol>
        </defs>
    </svg>


{% endblock %}

{% block javascript %}
    {{ block.super }}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdn.datatables.net/select/1.2.1/js/dataTables.select.min.js"></script>
    <script src="{% static 'dist/js/table_filter.js' %}"></script>
    <script src="{% static 'dist/js/bootstrap-select.js' %}"></script>
    <script src = "https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <!-- *** 자바스크립트 *** -->
    <script>
        $(document).ready(function() {
            // 데이터테이블 API
            $(function () {
                // 한국어로 변환 (Datatable)
                <!--
                var lang_kor = {
                    "decimal": "",
                    "emptyTable": "데이터가 없습니다.",
                    "info": "_START_ - _END_ (총 _TOTAL_ 인)",
                    "infoEmpty": "0명",
                    "infoFiltered": "(전체 _MAX_ 명 중 검색결과)",
                    "infoPostFix": "",
                    "thousands": ",",
                    "lengthMenu": "_MENU_ 개씩 보기",
                    "loadingRecords": "로딩중...",
                    "processing": "처리중...",
                    "search": "검색 : ",
                    "zeroRecords": "검색된 데이터가 없습니다.",
                    "paginate": {
                        "first": "첫 페이지",
                        "last": "마지막 페이지",
                        "next": "다음",
                        "previous": "이전"
                    },
                    "aria": {
                        "sortAscending": " :  오름차순 정렬",
                        "sortDescending": " :  내림차순 정렬"
                    }
                };
                -->
                // Datatable 설정 및 옵션
                $('#bootstrap-table').DataTable({
                    pageLength: 25,
                    dom: 'Bfrtip',
                    buttons: [
                    ],
                    ordering: false,
                    select: {
                        style: 'multi',
                        css: {
                            backgroundColor: 'pink'
                        }
                    },
                    info: false,
                    sorting: true,
                    bFilter: false,
                    autoWidth: false,
                    paging: false,
                });

                // 데이터 테이블 Row selection 관련
                $('#bootstrap-table').DataTable().on('key-focus', (e, dt, cell) => {
                    dt.row(cell.index().row).select();
                });

                // 엑셀 다운로드 버튼 위치 변경
                $('#bootstrap-table_wrapper > .dt-buttons').appendTo('.btn-group.btn-group.mb-4.align-items-center.get-excel');

                // 데이터 row 선택하기 (multiple rows selected)
                $('#bootstrap-table tbody tr').on('click', function () {
                    if ($(this).hasClass('selected')) {
                        $(this).removeClass('selected');

                    } else {
                        $(this).css('backgroundColor', '');
                        $(this).addClass('selected');
                    }
                });
            });
            // 주문 구분
            let order_date = document.querySelectorAll('.dateline');
            let order_no = document.querySelectorAll('.order_no');
            let customer = document.querySelectorAll('.customerline');
            let phone = document.querySelectorAll('.phoneline');
            let deploy = document.querySelectorAll('.deployline');
            for (let i = 1; i < order_no.length; i++) {
                if (order_date[i - 1].innerText === order_date[i].innerText && order_no[i - 1].innerText === order_no[i].innerText) {
                    order_date[i].style.color = 'rgba(255, 255, 255, 1.0)';
                    order_no[i].style.color = 'rgba(255, 255, 255, 1.0)';
                    customer[i].style.color = 'rgba(255, 255, 255, 1.0)';
                    phone[i].style.color = 'rgba(255, 255, 255, 1.0)';
                    deploy[i].style.color = 'rgba(255, 255, 255, 1.0)';
                }
            }

            // 엑셀 필터
            $('#bootstrap-table').excelTableFilter({
                search: true
            });
            // 주문 상세 모달
            $(function () {
                // CSS Work
                $(':input[readonly]').css({'background-color':'#ffffff'});

                // 주문 상세 모달
{#                {% for order in orderDetail %}#}
                    var pno = $('input[name="pno"]').val();
                    var real_pno = "{{ order.pno }}"
                    var order_type_value = "{{ order.order_type_name }}"
                    var pay_check_value = "{{ order.pay_check }}"

                    var option_ordertype = $("#selectbox_ordertype option:selected").val();

                    // 결제여부 (radio button) value 가져오기
                    if (pay_check_value == "O") {
                        $('input[name="radio_pay_check_yes"]').attr("checked", "checked");
                    } else if (pay_check_value == "X") {
                        $('input[name="radio_pay_check_no"]').attr("checked", "checked");
                    }
                    // 주문 수정 모달
                    $('#modal' + real_pno).on('click', function () {
                        $("#sizedModalLg{{ order.pno }}").modal({show:true});
                        $.ajax({
                            type: 'GET',
                            url: '/list/orderdetail?pno=' + real_pno,
                            data: {
                                pno: real_pno,
                            },
                            success: function (data) {
                            },
                            error: function (data, error) {
                                console.log(data)
                                console.log(error)
                            }
                        })
                    });
                    // 주문 수정 모달
                    $('#modify-order-btn' + real_pno).on('click', function () {
                        // 수정 버튼 클릭 시,
                        // input tag --> readonly 속성 사라짐
                        if (confirm("정말로 수정하시겠습니까?")) {
                            location.href = $(this).data('uri');
                        }
                    });
{#                {% endfor %}#}

            });
        });
    </script>
    <script>
        // csrf token 생성
        function getCookie(name) {
            console.log(1);
            let cookieValue = null;
            if(document.cookie && document.cookie !== '') {
                let cookies = document.cookie.split(';');
                for(let i = 0; i < cookies.length; i++) {
                    let cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if(cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        var csrftoken = getCookie('csrftoken');
        function csrfSafeMethod(method) {
            // these HTTP methods do not require CSRF protection
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }

        var xhr;

        // 출력에 사용되는 주문클래스
        class Order {
            constructor(orderdate, number, ordertype, customer, customerphone, delivery,
                        receiptdate, receipthour, payprice, paycheck, paytype, recipient,
                        recipientphone, address1, address2, memo, status,
                        name, size, fill, sheet, box, phrase, count) {
                this.orderdate = orderdate;
                this.number = number;
                this.ordertype = ordertype;
                this.customer = customer;
                this.customerphone = customerphone;
                this.delivery = delivery;
                this.receiptdate = receiptdate;
                this.receipthour = receipthour;
                this.payprice = payprice;
                this.paycheck = paycheck;
                this.paytype = paytype;
                this.recipient = recipient;
                this.recipientphone = recipientphone;
                this.address1 = address1;
                this.address2 = address2;
                this.memo = memo;
                this.status = status;
                this.name = name;
                this.size = size;
                this.fill = fill;
                this.sheet = sheet;
                this.box = box;
                this.phrase = phrase;
                this.count = count;
            }
        }

        // 주문목록 출력
        function printList() {

            const formtag = document.getElementById('searchForm');
            formtag.setAttribute('action', '/list/printlist');
            formtag.submit();

        }

        // 주문장 출력 - Pop Up
        function printAll() {
            let orderList = [];

            const printList = document.querySelectorAll('.selected');
            if (printList.length === 0) {
                alert('출력할 주문을 선택해주세요');
                return false;
            }

            for(let i = 0; i < printList.length; i++) {
                console.log(printList[i]);
                let order = printList[i].getElementsByTagName('td');
                let style = document.getElementById('valuedate').value;

                let piece;
                if (style === 'order') {
                    piece = new Order(order[1].innerText, order[2].innerText, order[22].innerText, order[4].innerText, order[5].innerText, order[15].innerText, order[20].innerText, order[21].innerText,
                        order[14].innerText, order[24].innerText, order[23].innerText, order[16].innerText, order[17].innerText, order[18].innerText, order[19].innerText, order[12].innerText,
                        order[3].innerText, order[6].innerText, order[8].innerText, order[10].innerText, order[9].innerText, order[13].innerText, order[11].innerText, order[7].innerText);
                } else {
                    piece = new Order(order[21].innerText, order[2].innerText, order[22].innerText, order[5].innerText, order[6].innerText, order[16].innerText, order[1].innerText, order[4].innerText,
                        order[15].innerText, order[24].innerText, order[23].innerText, order[17].innerText, order[18].innerText, order[19].innerText, order[20].innerText, order[13].innerText,
                        order[3].innerText, order[7].innerText, order[9].innerText, order[11].innerText, order[10].innerText, order[14].innerText, order[12].innerText, order[8].innerText);
                }
                orderList.push(piece);
            }
            let data = {"deposit" : orderList};
            let jsonData = JSON.stringify(data);
            $.ajaxSetup({
                beforeSend:function(xhr, settings) {
                    if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                        xhr.setRequestHeader("X-CSRFToken", csrftoken);
                    }
                }
            });
            $.ajax({
                type:'POST',
                url:'list/printall',
                data:jsonData,
                dataType:'json',
                contentType:'application/json; charset=utf-8',
                success: function() {
                    let popupX = (window.screen.width / 2) - (780 / 2);
                    let popupY= (window.screen.height /2) - (1080 / 2);
                    window.open('list/popup', 'Deposit Print', 'width=780, height=1080, top=100, left=800');
                },
                error:function(xhr, status, error) {
                    console.log(xhr+status+error);
                }
            });
        }

        // 주문 진행상태 변경
        function changeStatus(status) {
            let orderList = [];

            // 선택된 테이블row
            const changeList = document.querySelectorAll('.selected');
            // 선택된 행이 없을 경우 취소
            if (changeList.length === 0) {
                alert('변경할 주문을 선택해주세요');
                return false;
            }
            // 선택된 행의 pno 추출, orderList에 저장
            for(let i = 0; i < changeList.length; i++) {
                let order = changeList[i].getElementsByTagName('td');
                let pno = order[0].firstChild.value;
                orderList.push(pno);
            }

            // orderList에 담긴 pno를 통해 DB 접근
            let data = {"order" : orderList, "status" : status};
            let jsonData = JSON.stringify(data);
            $.ajaxSetup({
                beforeSend:function(xhr, settings) {
                    if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                        xhr.setRequestHeader("X-CSRFToken", csrftoken);
                    }
                }
            });
            $.ajax({
                type:'POST',
                url:'list/changestatus',
                data:jsonData,
                dataType:'json',
                contentType:'application/json; charset=utf-8',
                success: function(response) {
                    if(response.flag === '0') {
                        let msg = response.result_msg;
                        alert(msg);
                        location.reload();
                    }
                },
                error:function(xhr, status, error) {
                    console.log(xhr+status+error);
                }
            });

        }

        // 데이터리스트 조회 - 페이지, 검색, 날짜, 날짜기준, 게시글수 제어
        $(document).ready(function() {
            // 페이지네이션
            $('.page-link').on('click', function() {
                $('#page').val($(this).data('page'));
                $('#searchForm').submit();
            });
            // 검색
            $('#btn_search').on('click', function() {
                // 키워드 범위 설정
                $('#kwtype').val($('#kwtype1 option:selected').val());
                // 키워드 설정
                $('#kw').val($('.kw').val());
                // 게시글 수 설정
                $('#page_count').val($('#page_count1 option:selected').val());
                // 검색 후 1페이지부터 조회
                $('#page').val(1);
                $('#searchForm').submit();
            });
            // 게시글 수 조정
            $('#page_count1').on('change', function() {
                $('#kwtype').val($('#kwtype1 option:selected').val());
                $('#kw').val($('.kw').val());
                $('#page_count').val($('#page_count1 option:selected').val());
                $('#page').val(1);
                $('#searchForm').submit();
            })
        });
        // 자동완성 데이터 리스트
        let kwList = [];
        // 검색창 자동완성
        function searchList() {
            // 검색어 리스트
            $(".kw").autocomplete({
                source: kwList,
                select: function(event, ui) {
                },
                focus: function(event, ui) {
                    return false;
                }
            });
        }
        // 검색창 자동완성 데이터 조회(DB연동)
        $(document).on('propertychange change keyup paste input', '#searchList', function() {
            let fwtype = document.getElementById('kwtype1').value;
            let fwvalue = document.getElementById('searchList').value;
            let data = {"fwtype" : fwtype, "fwvalue" : fwvalue};
            let jsonData = JSON.stringify(data);
            $.ajax({
                type:'POST',
                url:'list/autocomplete/',
                data:jsonData,
                dataType:'json',
                contentType:'application/json; charset=utf-8',
                success: function(response) {
                    if(response.flag === '0') {
                        kwList = response.kwList;
                    }
                    searchList();
                },
                error:function(xhr, status, error) {
                    console.log(xhr+status+error);
                }
            });
        });
        // 주문일 & 납품일 기준 변경
        function changeDate(standar) {
            let order = document.getElementById('order_btn');
            let deploy = document.getElementById('deploy_btn');
            let valuedate = document.getElementById('valuedate');
            let startdate = document.getElementById('startdate');
            let enddate = document.getElementById('enddate');
            if (standar === 'order') {
                valuedate.value = document.getElementById('order_btn').dataset.date;
                startdate.value = '{{ firstday }}';
                enddate.value = '{{ lastday }}';
            } else if (standar === 'deploy') {
                valuedate.value = document.getElementById('deploy_btn').dataset.date;
                startdate.value = '{{ firstday }}';
                enddate.value = '{{ lastday }}';
            }
            $('#searchForm').submit();
        }
        // 날짜 검색 (DateRangePicker)
        let startDate = '{{ firstday }}';
        let endDate = '{{ lastday }}';
        $('#date_range2').daterangepicker({
            opens: "right",
            locale: {
                format: "YYYY년 MM월 DD일",
                separator: " ~ ",
                applyLabel: "확인",
                cancelLabel: "취소",
                fromLabel: "From",
                toLabel: "To",
                customRangeLabel: "사용자 지정",
                weekLabel: "W",
                daysOfWeek: ["일", "월", "화", "수", "목", "금", "토"],
                monthNames: ["1월", "2월", "3월", "4월", "5월", "6월", "7월", "8월", "9월", "10월", "11월", "12월"],
            },
            ranges: {
                // 날짜 set 제어
                "오늘": [moment(), moment()],
                "어제": [moment().subtract(1, "days"), moment().subtract(1, "days")],
                "7일 전": [moment().subtract(6, "days"), moment()],
                "내일": [moment().add(1, "days"), moment().add(1, "days")],
                "7일 후": [moment(), moment().add(6, "days")],
                "이번달": [moment().startOf("month"), moment().endOf("month")],
                "지난달": [moment().subtract(1, "month").startOf("month"), moment().subtract(1, "month").endOf("month")]
            },
            startDate: startDate,
            endDate: endDate,
        });
        // 날짜 start, end값 변수
        $('#date_range2').on('ready apply.daterangepicker', function(ev, picker) {
            let start = picker.startDate.format('YYYY-MM-DD');
            let end = picker.endDate.format('YYYY-MM-DD');
            // form 태그에 값 세팅
            let formstart = document.getElementById('startdate');
            let formend = document.getElementById('enddate');
            formstart.value = start;
            formend.value = end;
        });
        // 검색 form - 현재날짜 설정
        $(document).ready(function setDate() {
            let valuedate = document.getElementById('valuedate');
            let startdate = document.getElementById('startdate');
            let enddate = document.getElementById('enddate');
            if (startdate.value === '') {
                startdate.value = new Date().toISOString().substring(0, 10);
            }
            if (enddate.value === '') {
                enddate.value = new Date().toISOString().substring(0, 10);
            }
        });

        function orderUpdate() {
            // 선택된 테이블row
            const changeList = document.querySelectorAll('.selected');
            // 선택된 행이 없을 경우 취소
            if (changeList.length === 0) {
                alert('수정할 주문을 선택해주세요');
                return false;
            } else if (changeList.length > 1) {
                alert('1개만 선택해주세요');
                return false;
            }
            let order = changeList[0].getElementsByTagName('td');
            let pno = order[0].firstChild.value;
            location.href = '/list/crud?pno=' + pno;
        }
        function orderDelete() {
            // 선택된 테이블row
            const deleteList = document.querySelectorAll('.selected');
            // 선택된 행이 없을 경우 취소
            if (deleteList.length === 0) {
                alert('삭제할 주문을 선택해주세요');
                return false;
            }
            if (!confirm(`${deleteList.length}건 삭제하시겠습니까?`)) {
                return false;
            }
            let pno = [];
            for(let i = 0; i < deleteList.length; i++) {
                pno.push(deleteList[i].getElementsByTagName('td')[0].firstChild.value);
            }
            let data = {"pno" : pno};
            let jsonData = JSON.stringify(data);
            $.ajaxSetup({
                beforeSend:function(xhr, settings) {
                    if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                        xhr.setRequestHeader("X-CSRFToken", csrftoken);
                    }
                }
            });
            $.ajax({
                type:'POST',
                url:'/list/delete',
                data:jsonData,
                dataType:'json',
                contentType:'application/json; charset=utf-8',
                success:function(result) {
                    if(result.flag === 1) {
                        alert(result.msg);
                        location.href = '/';
                    } else if(result.flag === 0) {
                        alert(result.msg);
                    }
                },
                error:function(xhr, status, error) {
                    console.log(xhr+status+error);
                }
            });
        }
        class Excel {
            constructor(recipient, recipientphone, customerphone, address1, address2,
                        category, name, size, fill, sheet, box, count, memo, ) {
                this.recipient = recipient;
                this.recipientphone = recipientphone;
                this.customerphone = customerphone;
                this.address1 = address1
                this.address2 = address2
                this.category = category
                this.name = name
                this.size = size
                this.fill = fill
                this.sheet = sheet
                this.box = box
                this.count = count;
                this.memo = memo;
            }
        }
        class Excelfile {
            constructor(emp, order_date, date_no, order_no, order_type, customer, customer_phoen,
                        delivery, receipt_date, receipt_hour, box, phrase, memo, pay_price, product,
                        size, sheet, fill, count, price, recipient, recipientphone, address1,
                        address2, pay_check, pay_type, status, cafe24_no) {

                this.employee_name = emp;
                this.order_date = order_date;
                this.date_no = date_no;
                this.order_no = order_no;
                this.order_type_name = order_type;
                this.customer = customer;
                this.customerphone = customer_phoen;
                this.delivery = delivery;
                this.receipt_date = receipt_date;
                this.receipt_hour = receipt_hour;
                this.box = box;
                this.phrase = phrase;
                this.memo = memo;
                this.pay_price = pay_price;
                this.product = product;
                this.size = size;
                this.sheet = sheet;
                this.fill = fill;
                this.count = count;
                this.price = price;
                this.recipient = recipient;
                this.recipientphone = recipientphone;
                this.address1 = address1;
                this.address2 = address2;
                this.pay_check = pay_check;
                this.pay_type = pay_type;
                this.status = status;
                this.cafe24_no = cafe24_no;
            }
        }

        const objAjax = async (idList) => {
            let list;
            let formdata = {'order_id':idList};
            let jsonData = JSON.stringify(formdata);

            $.ajaxSetup({
                headers: {'X-CSRFToken': '{{ csrf_token }}'}
            });
            await $.ajax({
                type:'POST',
                url:'/list/page_list/',
                data:jsonData,
                dataType:'json',
                contentType:'application/json; charset=utf-8',
                success: (response) => {
                    list = response.list;
                },
                error:function(xhr, status, error) {
                    console.log(xhr+status+error);
                }
            });
            return list;
        }

        //
        // 주문목록 엑셀 추출
        async function filecreate() {
            let filename;
            let pattern = /[^가-힣ㄱ-ㅎㅏ-ㅣa-zA-Z0-9]/gi;
            let result;
            while (true) {
                filename = prompt('파일명을 입력해주세요', '주문목록');

                if (pattern.test(filename)) {
                    filename = filename.replace(pattern, '');
                    alert('특수문자는 사용할 수 없습니다.');
                    continue;
                }

                if (filename === '') {
                    alert('빈 칸은 사용할 수 없습니다');
                } else if(filename === null) {
                    return false;
                } else {
                    break;
                }
            }
            let order = [];
            let excelorder;
            let order_no = document.querySelectorAll('.pageobj_pno');
            let idList = [];
            for (let i = 0; i < order_no.length; i++) {
                idList.push(order_no[i].value);
            }
            const pageList = await objAjax(idList);
            for (let i = 0; i < pageList.length; i++) {
                let a = pageList[i][0];
                excelorder = new Excelfile(a.employee_name, a.order_date, a.date_no, a.order_no,
                                            a.order_type_name, a.customer, a.customer_phone,
                                            a.delivery_option_name, a.receipt_date, a.receipt_hour,
                                            a.boxing_option_name, a.phrase, a.memo, a.total_price,
                                            a.product_name, a.size_option_name, a.sheet_option_name,
                                            a.filling_option_name, a.count, a.product_price, a.recipient,
                                            a.recipient_phone, a.address1, a.address2,
                                            a.pay_check, a.pay_type_name, a.state, a.cafe24_no);
                order.push(excelorder);
            }
            let jsonData = {"name":filename, "order":order};
            jsonData = JSON.stringify(jsonData);
            await $.ajax({
                type: 'POST',
                url:`/list/filedown/`,
                data:jsonData,
                dataType:'json',
                contentType:'application/json; charset=utf-8',
                success: function(response) {
                    result = response;
                },
                error: function(xhr, status, error) {
                    console.log(xhr + status + error);
                }
            });
            if (result.flag === 1) {
                exceldown(filename);

            } else if (result.flag === 0) {
                alert(result.msg);
            }
        }
        // 택배송장 엑셀파일 추출
        async function excelcreate() {
            let filename;
            let pattern = /[^가-힣ㄱ-ㅎㅏ-ㅣa-zA-Z0-9]/gi;
            let result;
            while (true) {
                filename = prompt('파일명을 입력해주세요', 'cj송장양식');

                if (pattern.test(filename)) {
                    filename = filename.replace(pattern, '');
                    alert('특수문자는 사용할 수 없습니다.');
                    continue;
                }

                if (filename === '') {
                    alert('빈 칸은 사용할 수 없습니다');
                } else if(filename === null) {
                    return false;
                } else {
                    break;
                }
            }
            let order = [];
            let excelorder;
            {% for order in orderDetail %}
                console.log('{{ order.delivery_option_name }}');
                {% if order.delivery_option_name == '일반택배' %}
                excelorder = new Excel("{{ order.recipient }}", "{{ order.recipient_phone }}", "{{ order.customer_phone }}", "{{ order.address1 }}", "{{ order.address2 }}",
                                            "떡", "{{ order.product_name }}", "{{ order.size_option_name }}", "{{ order.filling_option_name }}",
                                            "{{ order.sheet_option_name }}", "{{ order.boxing_option_name }}", "{{ order.count }}", "{{ order.memo }}", "{{ order.cafe24_no }}");
                order.push(excelorder);
                {% endif %}
            {% endfor %}
            let jsonData = {"name":filename, "order":order};
            jsonData = JSON.stringify(jsonData);
            await $.ajax({
                type: 'POST',
                url:`/list/exceldown/`,
                data:jsonData,
                dataType:'json',
                contentType:'application/json; charset=utf-8',
                success: function(response) {
                    result = response;
                },
                error: function(xhr, status, error) {
                    console.log(xhr + status + error);
                }
            });
            if (result.flag === 1) {
                exceldown(filename);

            } else if (result.flag === 0) {
                alert(result.msg);
            }
        }
        // 서버에서 클라이언트로 다운로드
        function exceldown(name) {
            let url = `static/excel/${name}.xlsx`;

            $.ajax({
                url: url,
                type: 'get',
                xhrFields: {
                   responseType: 'blob'
                },
                success: function(response) {
                    let blob = new Blob([response]);

                    if (navigator.msSaveBlob) {
                        return navigator.msSaveBlob(blob, name);
                    } else {
                        let link = document.createElement('a');
                        link.href = window.URL.createObjectURL(blob);
                        link.download = `${name}.xlsx`;
                        link.click();
                    }
                    exceldel(name);
                }
            });
        }

        function exceldel(name) {
            $.ajax({
                url: `/list/exceldel/?name=${name}`,
                type: 'get',
                success: function(response) {
                    console.log('엑셀 다운로드 후 서버파일 삭제 완료'); // 테스트 후 삭제할것
                },
                error: function(error) {
                    console.log(xhr + status + error);
                }
            });
        }

        <!-- 엑셀 업로드 -->
        function uploadpopup() {
            let popupX = (window.screen.width / 2) - (780 / 2);
            let popupY= (window.screen.height /2) - (1080 / 2);
            window.open('/list/upload/', 'Deposit Print', 'width=780, height=300, top=100, left=800');
        }
    </script>

{% endblock javascript %}

